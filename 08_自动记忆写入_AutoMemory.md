# 🧲 自动记忆写入法则 (Auto-Memory Write Protocol)

`[实体: 系统规范, 隐式归档]`
`[关联: 06_终局归档, 02_USER(No-Ask), 10_Focus]`
`[状态: 活跃]`
`[更新日期: YYYY-MM-DD]`

---

## 📌 核心原则 (chunk: < 400 tokens)
*AI 助手必须在对话过程中**持续、无声地**将有价值信息归入记忆系统，而非等到用户说"结束对话"才一次性封存。*

- **绝不问** "要不要记录？" / "记到哪个文件？" → 自主判断、默默执行
- **🔴 密钥自查铁规**: 需要任何密钥/Token/Key 时，**必须先查 `秘钥文档/00_密钥总控台_Registry.md`**，再用文件读取工具获取实际值。**绝不向用户索要已存在于记忆系统中的密钥**。
- **写入粒度**: 单条写入 ≤ 400 tokens，保持高压缩比
- **来源双扫描**: 同时扫描当前对话上下文 + AI 平台原生记忆缓存

---

## ⚙️ 触发条件 (When to Write)

| 触发信号 | 动作 | 目标文件 |
| :--- | :--- | :--- |
| 项目架构决策达成共识 | 提炼规则/约定 | `07_DevRules.md` 或 `20_Projects/对应项目.md` |
| 新项目首次讨论 | 创建项目知识卡 | `20_Projects/新项目名.md`（用模板） |
| 核心领域知识产出 | 压缩入库 | `30_Domains/对应领域.md` |
| Phase/里程碑竣工 | 更新进度表 | `20_Projects/对应项目.md` 的里程碑表 |
| 新的待办/阻塞项 | 追加条目 | `10_Focus.md` 对应优先级区 |
| 密钥/凭证变更 | 更新注册表 | `秘钥文档/00_密钥总控台_Registry.md` |
| Focus 超过 60 行 | 已完成项移出 | 移入 `99_Logs/` 后删除 Focus 中的条目 |

---

## 🚫 不写入的情况

- 纯闲聊/一次性问答（如"JavaScript async怎么用"）
- 尚未达成共识的临时草案（等确认后再写）
- 已存在于记忆中且未变更的重复信息

---

## 🔄 与终局归档的关系

| 时机 | 协议 | 说明 |
| :--- | :--- | :--- |
| **对话中** | 本协议 (Auto-Memory) | 逐步增量写入，不等结束 |
| **对话结束** | `06_终局归档法则` | 最终扫描兜底 + 日志封存 + 退场汇报 |

> 两者互补：Auto-Memory 保证过程中不丢信息，终局归档保证结束时兜底封存。

---
> **记忆索引**:
> - 用户画像中的 No-Ask 原则: `02_用户画像_USER.md`
> - 终局归档 SOP: `06_终局归档法则_Archiving.md`
> - Focus 行数硬上限: `10_当前焦点_Focus.md` 第5行
